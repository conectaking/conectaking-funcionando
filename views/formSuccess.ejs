<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Formul√°rio Enviado com Sucesso - King Forms</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <% if (showGuestListInfo && typeof qrToken !== 'undefined' && qrToken) { %>
    <script src="https://cdn.jsdelivr.net/gh/davidshimjs/qrcodejs@gh-pages/qrcode.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <% } %>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            <% if (typeof backgroundImageUrl !== 'undefined' && backgroundImageUrl) { %>
            background-image: url('<%= backgroundImageUrl %>');
            background-size: cover;
            background-position: center;
            background-attachment: fixed;
            background-color: <%= backgroundColor || '#FFFFFF' %>;
            <% if (typeof backgroundOpacity !== 'undefined' && parseFloat(backgroundOpacity) < 1) { %>
            position: relative;
            <% } %>
            <% } else { %>
            background: linear-gradient(135deg, <%= primaryColor || '#4A90E2' %> 0%, <%= secondaryColor || '#6BA3F0' %> 100%);
            <% } %>
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        
        <% if (typeof backgroundImageUrl !== 'undefined' && backgroundImageUrl && typeof backgroundOpacity !== 'undefined' && parseFloat(backgroundOpacity) < 1) { %>
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: <%= backgroundColor || '#FFFFFF' %>;
            opacity: <%= 1 - (parseFloat(backgroundOpacity) || 0) %>;
            z-index: -1;
        }
        <% } %>
        
        .success-container {
            background: linear-gradient(135deg, rgba(255,255,255,0.98) 0%, rgba(248,250,252,0.98) 100%);
            backdrop-filter: blur(20px);
            border: 2px solid rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.2);
            border-radius: 32px;
            padding: 56px 48px;
            max-width: 700px;
            width: 100%;
            box-shadow: 0 24px 80px rgba(0, 0, 0, 0.25), 0 0 0 1px rgba(0,0,0,0.05) inset;
            text-align: center;
            animation: slideUp 0.5s ease-out;
            position: relative;
            overflow: hidden;
        }
        
        .success-container::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.08) 0%, transparent 70%);
            animation: rotate 20s linear infinite;
            z-index: 0;
        }
        
        .success-container > * {
            position: relative;
            z-index: 1;
        }
        
        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }
        
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .success-icon {
            width: 120px;
            height: 120px;
            background: linear-gradient(135deg, #4caf50, #45a049);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
            animation: scaleIn 0.5s ease-out 0.2s both;
        }
        
        @keyframes scaleIn {
            from {
                transform: scale(0);
            }
            to {
                transform: scale(1);
            }
        }
        
        .success-icon i {
            font-size: 64px;
            color: white;
        }
        
        h1 {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, <%= primaryColor || '#4A90E2' %> 0%, <%= secondaryColor || '#6BA3F0' %> 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            margin-bottom: 20px;
            text-shadow: 0 2px 8px rgba(0,0,0,0.1);
            line-height: 1.3;
        }
        
        .success-message {
            font-size: 18px;
            color: #2C3E50;
            margin-bottom: 32px;
            line-height: 1.7;
            font-weight: 500;
        }
        
        .response-id {
            background: linear-gradient(135deg, rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.1) 0%, rgba(<%= secondaryColor ? parseInt(secondaryColor.slice(1, 3), 16) + ',' + parseInt(secondaryColor.slice(3, 5), 16) + ',' + parseInt(secondaryColor.slice(5, 7), 16) : '107,163,240' %>, 0.08) 100%);
            border: 2px solid rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.2);
            border-radius: 16px;
            padding: 20px;
            margin: 24px 0;
            font-family: 'Courier New', monospace;
            font-size: 15px;
            color: #1A1A1A;
            font-weight: 600;
        }
        
        .response-id strong {
            color: <%= primaryColor || '#4A90E2' %>;
            display: block;
            margin-bottom: 10px;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: 700;
        }
        
        .actions {
            display: flex;
            gap: 12px;
            justify-content: center;
            flex-wrap: wrap;
            margin-top: 32px;
        }
        
        .btn {
            padding: 14px 28px;
            border-radius: 12px;
            font-weight: 600;
            font-size: 16px;
            cursor: pointer;
            border: none;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, <%= primaryColor || '#4A90E2' %> 0%, <%= secondaryColor || '#6BA3F0' %> 100%);
            color: white;
            box-shadow: 0 4px 20px rgba(74, 144, 226, 0.4);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(74, 144, 226, 0.5);
        }
        
        .btn-secondary {
            background: #f8f9fa;
            color: #5f6368;
        }
        
        .btn-secondary:hover {
            background: #e8eaed;
        }
        
        .info-box {
            background: linear-gradient(135deg, rgba(76, 175, 80, 0.12) 0%, rgba(69, 160, 73, 0.08) 100%);
            border: 2px solid rgba(76, 175, 80, 0.3);
            border-left: 5px solid #4caf50;
            border-radius: 16px;
            padding: 20px;
            margin: 24px 0;
            text-align: left;
            box-shadow: 0 4px 16px rgba(76, 175, 80, 0.1);
        }
        
        .info-box strong {
            color: #2e7d32;
            display: block;
            margin-bottom: 10px;
            font-size: 16px;
            font-weight: 700;
        }
        
        .info-box p {
            color: #1b5e20;
            font-size: 15px;
            margin: 0;
            line-height: 1.7;
            font-weight: 500;
        }
        
        @media (max-width: 600px) {
            body {
                padding: 12px;
            }
            
            .success-container {
                padding: 28px 20px;
                border-radius: 24px;
            }
            
            .success-icon {
                width: 90px;
                height: 90px;
                margin-bottom: 24px;
            }
            
            .success-icon i {
                font-size: 48px;
            }
            
            h1 {
                font-size: 24px;
                margin-bottom: 16px;
            }
            
            .success-message {
                font-size: 15px;
                margin-bottom: 24px;
            }
            
            .response-id {
                padding: 16px !important;
                margin: 20px 0 !important;
                font-size: 14px !important;
            }
            
            .response-id strong {
                font-size: 12px !important;
            }
            
            .info-box {
                padding: 16px !important;
                margin: 20px 0 !important;
            }
            
            .info-box strong {
                font-size: 15px !important;
            }
            
            .info-box p {
                font-size: 14px !important;
            }
            
            .actions {
                flex-direction: column;
                gap: 12px;
                margin-top: 24px;
            }
            
            .btn {
                width: 100%;
                justify-content: center;
                padding: 14px 20px;
                font-size: 15px;
            }
            
            #qr-code-section {
                padding: 20px 12px !important;
                margin: 20px 0 !important;
            }
            
            #qr-code-section > div:first-of-type {
                padding: 16px !important;
            }
            
            #qrcode-container {
                display: flex !important;
                justify-content: center !important;
                align-items: center !important;
                width: 100% !important;
            }
            
            #qrcode-container canvas,
            #qrcode-container img {
                max-width: 100% !important;
                height: auto !important;
                margin: 0 auto !important;
            }
            
            /* Ajustar cards de dados submetidos */
            div[style*="background: linear-gradient"][style*="border-radius: 20px"] {
                padding: 20px 16px !important;
                margin: 20px 0 !important;
            }
            
            div[style*="background: linear-gradient"][style*="border-radius: 20px"] h3 {
                font-size: 18px !important;
                margin-bottom: 16px !important;
            }
            
            div[style*="padding: 20px"][style*="background: rgba(255,255,255"] {
                padding: 16px !important;
                margin-bottom: 12px !important;
            }
            
            div[style*="padding: 20px"][style*="background: rgba(255,255,255"] div[style*="font-size: 12px"] {
                font-size: 11px !important;
                margin-bottom: 8px !important;
            }
            
            div[style*="padding: 20px"][style*="background: rgba(255,255,255"] div[style*="font-size: 18px"] {
                font-size: 16px !important;
            }
        }
    </style>
</head>
<body>
    <div class="success-container">
        <div class="success-icon">
            <i class="fas fa-check"></i>
        </div>
        
        <h1>
            <% if (showGuestListInfo) { %>
                ‚úÖ Parab√©ns! Inscri√ß√£o Realizada com Sucesso!
            <% } else { %>
                ‚úÖ Formul√°rio Enviado com Sucesso!
            <% } %>
        </h1>
        
        <p class="success-message">
            <%= message || (showGuestListInfo ? 'Parab√©ns! Sua inscri√ß√£o foi realizada com sucesso. Voc√™ foi adicionado √† nossa lista e aguardamos voc√™ no evento!' : 'Obrigado por preencher o formul√°rio. Sua resposta foi registrada com sucesso.') %>
        </p>
        
        <% if (responseId) { %>
        <div class="response-id">
            <strong>N√∫mero de Refer√™ncia</strong>
            <span style="font-family: 'Courier New', monospace; font-size: 18px; font-weight: 700; color: <%= primaryColor || '#4A90E2' %>;">
                REF-<%= String(responseId).padStart(6, '0') %>
            </span>
        </div>
        <% } %>
        
        <% if (typeof submittedData !== 'undefined' && submittedData && Object.keys(submittedData).length > 0) { %>
        <div style="background: linear-gradient(135deg, rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.12) 0%, rgba(<%= secondaryColor ? parseInt(secondaryColor.slice(1, 3), 16) + ',' + parseInt(secondaryColor.slice(3, 5), 16) + ',' + parseInt(secondaryColor.slice(5, 7), 16) : '107,163,240' %>, 0.08) 100%); border-radius: 20px; padding: 28px; margin: 24px 0; text-align: left; border: 2px solid rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.25); box-shadow: 0 8px 24px rgba(0,0,0,0.1);">
            <h3 style="font-size: 22px; font-weight: 800; color: #1A1A1A; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-clipboard-check" style="color: <%= primaryColor || '#4A90E2' %>; font-size: 26px;"></i>
                Informa√ß√µes da Sua Inscri√ß√£o
            </h3>
            <div style="display: grid; gap: 18px;">
                <% Object.keys(submittedData).forEach(key => { %>
                    <% 
                        const value = submittedData[key];
                        const displayValue = typeof value === 'string' ? decodeURIComponent(value) : value;
                    %>
                    <% if (displayValue && displayValue.toString().trim() !== '') { %>
                    <div style="padding: 20px; background: rgba(255,255,255,0.95); border-radius: 14px; border-left: 5px solid <%= primaryColor || '#4A90E2' %>; box-shadow: 0 4px 12px rgba(0,0,0,0.08); transition: all 0.3s;" onmouseover="this.style.transform='translateX(6px)'; this.style.boxShadow='0 6px 16px rgba(0,0,0,0.12)';" onmouseout="this.style.transform='translateX(0)'; this.style.boxShadow='0 4px 12px rgba(0,0,0,0.08)';">
                        <div style="font-size: 12px; color: <%= primaryColor || '#4A90E2' %>; text-transform: uppercase; letter-spacing: 1.5px; margin-bottom: 10px; font-weight: 700;">
                            <%= key.replace(/data_/g, '').replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %>
                        </div>
                        <div style="font-size: 18px; color: #1A1A1A; font-weight: 700; line-height: 1.6;">
                            <%= displayValue %>
                        </div>
                    </div>
                    <% } %>
                <% }); %>
            </div>
        </div>
        <% } else if (typeof responseData !== 'undefined' && responseData && (responseData.response_data || responseData.responder_name || responseData.responder_email || responseData.responder_phone)) { %>
        <div style="background: linear-gradient(135deg, rgba(74, 144, 226, 0.05), rgba(107, 163, 240, 0.08)); border-radius: 12px; padding: 24px; margin: 24px 0; text-align: left; border: 1px solid rgba(74, 144, 226, 0.2);">
            <h3 style="font-size: 20px; font-weight: 700; color: #202124; margin-bottom: 20px; display: flex; align-items: center; gap: 12px;">
                <i class="fas fa-clipboard-check" style="color: <%= primaryColor || '#4A90E2' %>; font-size: 24px;"></i>
                Informa√ß√µes da Sua Inscri√ß√£o
            </h3>
            <div style="display: grid; gap: 16px;">
                <% if (responseData.responder_name) { %>
                <div style="padding: 16px; background: white; border-radius: 10px; border-left: 4px solid <%= primaryColor || '#4A90E2' %>; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-size: 11px; color: #5f6368; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600;">Nome Completo</div>
                    <div style="font-size: 17px; color: #202124; font-weight: 600;"><%= responseData.responder_name %></div>
                </div>
                <% } %>
                <% if (responseData.responder_email) { %>
                <div style="padding: 16px; background: white; border-radius: 10px; border-left: 4px solid <%= primaryColor || '#4A90E2' %>; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-size: 11px; color: #5f6368; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600;">E-mail</div>
                    <div style="font-size: 17px; color: #202124; font-weight: 600;"><%= responseData.responder_email %></div>
                </div>
                <% } %>
                <% if (responseData.responder_phone) { %>
                <div style="padding: 16px; background: white; border-radius: 10px; border-left: 4px solid <%= primaryColor || '#4A90E2' %>; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                    <div style="font-size: 11px; color: #5f6368; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600;">Telefone/WhatsApp</div>
                    <div style="font-size: 17px; color: #202124; font-weight: 600;"><%= responseData.responder_phone %></div>
                </div>
                <% } %>
                <% if (typeof responseData.response_data === 'object' && responseData.response_data) { %>
                    <% Object.keys(responseData.response_data).forEach(key => { %>
                        <% 
                            const value = responseData.response_data[key];
                            const displayValue = typeof value === 'object' ? JSON.stringify(value) : value;
                        %>
                        <% if (displayValue && displayValue.toString().trim() !== '' && key !== 'name' && key !== 'nome' && key !== 'email' && key !== 'phone' && key !== 'whatsapp' && key !== 'telefone') { %>
                        <div style="padding: 16px; background: white; border-radius: 10px; border-left: 4px solid <%= primaryColor || '#4A90E2' %>; box-shadow: 0 2px 8px rgba(0,0,0,0.05);">
                            <div style="font-size: 11px; color: #5f6368; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 8px; font-weight: 600;">
                                <%= key.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase()) %>
                            </div>
                            <div style="font-size: 17px; color: #202124; font-weight: 600; line-height: 1.5;">
                                <%= displayValue %>
                            </div>
                        </div>
                        <% } %>
                    <% }); %>
                <% } %>
            </div>
        </div>
        <% } %>
        
        <% if (showWhatsAppInfo && whatsappNumber) { %>
        <div class="info-box">
            <strong><i class="fab fa-whatsapp"></i> Pr√≥ximos Passos</strong>
            <p>Verifique o WhatsApp para continuar o atendimento. Se n√£o recebeu a mensagem, verifique se o n√∫mero est√° correto.</p>
        </div>
        <% } %>
        
        <% if (showGuestListInfo) { %>
        <div class="info-box" style="background: linear-gradient(135deg, rgba(76, 175, 80, 0.15), rgba(69, 160, 73, 0.2)); border: 2px solid rgba(76, 175, 80, 0.4); padding: 32px; border-radius: 20px; margin: 32px 0; box-shadow: 0 8px 24px rgba(76, 175, 80, 0.2); position: relative; overflow: hidden;">
            <div style="position: absolute; top: -50px; right: -50px; width: 150px; height: 150px; background: rgba(76, 175, 80, 0.1); border-radius: 50%; z-index: 0;"></div>
            <div style="position: absolute; bottom: -30px; left: -30px; width: 100px; height: 100px; background: rgba(69, 160, 73, 0.1); border-radius: 50%; z-index: 0;"></div>
            <div style="position: relative; z-index: 1;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 16px;">
                    <div style="width: 60px; height: 60px; background: linear-gradient(135deg, #4caf50, #45a049); border-radius: 50%; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(76, 175, 80, 0.4);">
                        <i class="fas fa-check-circle" style="font-size: 32px; color: white;"></i>
                    </div>
                    <strong style="color: #2e7d32; font-size: 24px; font-weight: 700; text-shadow: 0 2px 4px rgba(0,0,0,0.1);">
                        üéâ Parab√©ns! Inscri√ß√£o Confirmada
                    </strong>
                </div>
                <p style="color: #1b5e20; font-size: 18px; line-height: 1.8; margin: 0; text-align: center; font-weight: 500;">
                    Sua inscri√ß√£o foi realizada com <strong style="color: #2e7d32;">sucesso</strong>!<br>
                    Voc√™ foi adicionado √† nossa lista de convidados e aguardamos voc√™ no evento!<br><br>
                    <span style="font-size: 16px; color: #2e7d32; font-weight: 600;">‚ú® Aguarde o nosso contato - entraremos em contato em breve para mais informa√ß√µes.</span>
                </p>
            </div>
        </div>
        <% } %>
        
        <% if (showGuestListInfo && typeof qrToken !== 'undefined' && qrToken) { %>
        <!-- QR Code de Confirma√ß√£o de Presen√ßa - Design Premium -->
        <div id="qr-code-section" style="background: linear-gradient(135deg, rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.08), rgba(<%= secondaryColor ? parseInt(secondaryColor.slice(1, 3), 16) + ',' + parseInt(secondaryColor.slice(3, 5), 16) + ',' + parseInt(secondaryColor.slice(5, 7), 16) : '107,163,240' %>, 0.12)); border: 3px solid rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.4); border-radius: 24px; padding: 40px; margin: 40px 0; text-align: center; box-shadow: 0 12px 40px rgba(0,0,0,0.15); position: relative; overflow: hidden;">
            <!-- Decora√ß√£o de fundo -->
            <div style="position: absolute; top: -30px; right: -30px; width: 200px; height: 200px; background: rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.1); border-radius: 50%; z-index: 0;"></div>
            <div style="position: absolute; bottom: -20px; left: -20px; width: 150px; height: 150px; background: rgba(<%= secondaryColor ? parseInt(secondaryColor.slice(1, 3), 16) + ',' + parseInt(secondaryColor.slice(3, 5), 16) + ',' + parseInt(secondaryColor.slice(5, 7), 16) : '107,163,240' %>, 0.1); border-radius: 50%; z-index: 0;"></div>
            
            <div style="position: relative; z-index: 1;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 16px; margin-bottom: 32px;">
                    <div style="width: 56px; height: 56px; background: linear-gradient(135deg, <%= primaryColor || '#4A90E2' %>, <%= secondaryColor || '#6BA3F0' %>); border-radius: 16px; display: flex; align-items: center; justify-content: center; box-shadow: 0 6px 20px rgba(74, 144, 226, 0.4);">
                        <i class="fas fa-qrcode" style="font-size: 32px; color: white;"></i>
                    </div>
                    <h2 style="margin: 0; font-size: 28px; font-weight: 800; color: #202124; text-shadow: 0 2px 4px rgba(0,0,0,0.1); letter-spacing: -0.5px;">QR Code de Confirma√ß√£o</h2>
                </div>
                
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(255,255,255,0.98)); border-radius: 20px; padding: 32px; margin-bottom: 24px; display: flex; justify-content: center; align-items: center; box-shadow: 0 8px 32px rgba(0,0,0,0.12), inset 0 1px 0 rgba(255,255,255,0.8); border: 2px solid rgba(255,255,255,0.5);">
                    <div id="qrcode-container" style="display: flex; justify-content: center; align-items: center;"></div>
                </div>
            
            <!-- Aviso Importante -->
            <div style="background: linear-gradient(135deg, rgba(255, 199, 0, 0.15), rgba(255, 199, 0, 0.25)); border: 2px solid rgba(255, 199, 0, 0.4); border-radius: 12px; padding: 20px; margin: 20px 0;">
                <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 12px;">
                    <i class="fas fa-exclamation-triangle" style="font-size: 24px; color: #FFC700;"></i>
                    <strong style="font-size: 18px; color: #202124;">‚ö†Ô∏è IMPORTANTE</strong>
                </div>
                <p style="font-size: 16px; color: #333; line-height: 1.6; margin: 0;">
                    <strong>Tire um print ou baixe o QR Code</strong> para n√£o perder!<br>
                    Apresente este QR Code na portaria do evento para confirmar sua presen√ßa.
                </p>
            </div>
            
                <!-- Informa√ß√µes do Evento no QR Code - Design Premium -->
                <% if (eventTitle || eventDate || eventAddress) { %>
                <div style="background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,249,250,0.98)); border-radius: 16px; padding: 28px; margin: 24px 0; text-align: left; border: 2px solid rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.2); box-shadow: 0 4px 16px rgba(0,0,0,0.08);">
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 20px; padding-bottom: 16px; border-bottom: 2px solid rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.2);">
                        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, <%= primaryColor || '#4A90E2' %>, <%= secondaryColor || '#6BA3F0' %>); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-info-circle" style="font-size: 24px; color: white;"></i>
                        </div>
                        <h3 style="font-size: 18px; font-weight: 700; color: #202124; margin: 0; text-transform: uppercase; letter-spacing: 0.5px;">Informa√ß√µes do Evento</h3>
                    </div>
                    <% if (eventTitle) { %>
                    <div style="margin-bottom: 16px; padding: 16px; background: linear-gradient(135deg, rgba(<%= primaryColor ? parseInt(primaryColor.slice(1, 3), 16) + ',' + parseInt(primaryColor.slice(3, 5), 16) + ',' + parseInt(primaryColor.slice(5, 7), 16) : '74,144,226' %>, 0.1), rgba(<%= secondaryColor ? parseInt(secondaryColor.slice(1, 3), 16) + ',' + parseInt(secondaryColor.slice(3, 5), 16) + ',' + parseInt(secondaryColor.slice(5, 7), 16) : '107,163,240' %>, 0.1)); border-radius: 12px; border-left: 4px solid <%= primaryColor || '#4A90E2' %>;">
                        <div style="font-size: 12px; color: #5f6368; text-transform: uppercase; letter-spacing: 1px; margin-bottom: 6px; font-weight: 600;">Nome do Evento</div>
                        <strong style="color: #202124; font-size: 22px; font-weight: 700; line-height: 1.3;"><%= eventTitle %></strong>
                    </div>
                    <% } %>
                    <% if (eventDate) { %>
                    <div style="display: flex; align-items: center; gap: 12px; margin-bottom: 14px; padding: 12px 16px; background: rgba(255,255,255,0.6); border-radius: 10px;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #FF6B6B, #FF8787); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;">
                            <i class="fas fa-calendar-alt" style="font-size: 18px; color: white;"></i>
                        </div>
                        <div>
                            <div style="font-size: 11px; color: #5f6368; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Data do Evento</div>
                            <span style="color: #202124; font-size: 16px; font-weight: 600;"><%= new Date(eventDate).toLocaleDateString('pt-BR', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' }) %></span>
                        </div>
                    </div>
                    <% } %>
                    <% if (eventAddress) { %>
                    <div style="display: flex; align-items: flex-start; gap: 12px; padding: 12px 16px; background: rgba(255,255,255,0.6); border-radius: 10px;">
                        <div style="width: 40px; height: 40px; background: linear-gradient(135deg, #4ECDC4, #44A08D); border-radius: 10px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; margin-top: 2px;">
                            <i class="fas fa-map-marker-alt" style="font-size: 18px; color: white;"></i>
                        </div>
                        <div style="flex: 1;">
                            <div style="font-size: 11px; color: #5f6368; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 4px; font-weight: 600;">Local do Evento</div>
                            <span style="color: #202124; font-size: 16px; font-weight: 600; line-height: 1.5;"><%= eventAddress %></span>
                        </div>
                    </div>
                    <% } %>
                </div>
                <% } %>
            </div>
            
                <!-- Bot√µes de A√ß√£o Premium -->
                <div style="display: flex; gap: 16px; justify-content: center; flex-wrap: wrap; margin-top: 32px;">
                    <button onclick="showQRCodePreview()" class="btn" style="background: linear-gradient(135deg, <%= primaryColor || '#4A90E2' %> 0%, <%= secondaryColor || '#6BA3F0' %> 100%); color: white; border: none; padding: 16px 32px; border-radius: 14px; font-weight: 700; font-size: 16px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s; box-shadow: 0 6px 24px rgba(74, 144, 226, 0.4); transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 30px rgba(74, 144, 226, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 24px rgba(74, 144, 226, 0.4)';">
                        <i class="fas fa-eye" style="font-size: 18px;"></i> Ver Preview
                    </button>
                    <button onclick="downloadQRCode()" class="btn" style="background: white; color: <%= primaryColor || '#4A90E2' %>; border: 3px solid <%= primaryColor || '#4A90E2' %>; padding: 16px 32px; border-radius: 14px; font-weight: 700; font-size: 16px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s; box-shadow: 0 4px 16px rgba(0,0,0,0.1); transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 20px rgba(0,0,0,0.15)'; this.style.background='<%= primaryColor || '#4A90E2' %>'; this.style.color='white';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 16px rgba(0,0,0,0.1)'; this.style.background='white'; this.style.color='<%= primaryColor || '#4A90E2' %>';">
                        <i class="fas fa-download" style="font-size: 18px;"></i> Baixar PNG
                    </button>
                    <button onclick="downloadQRCodePDF()" class="btn" style="background: linear-gradient(135deg, #DC143C, #FF6347); color: white; border: none; padding: 16px 32px; border-radius: 14px; font-weight: 700; font-size: 16px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s; box-shadow: 0 6px 24px rgba(220, 20, 60, 0.4); transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 30px rgba(220, 20, 60, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 24px rgba(220, 20, 60, 0.4)';">
                        <i class="fas fa-file-pdf" style="font-size: 18px;"></i> Baixar PDF
                    </button>
                    <button onclick="shareQRCode()" class="btn btn-secondary" style="background: linear-gradient(135deg, #25D366, #20BA5A); color: white; border: none; padding: 16px 32px; border-radius: 14px; font-weight: 700; font-size: 16px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; transition: all 0.3s; box-shadow: 0 6px 24px rgba(37, 211, 102, 0.4); transform: translateY(0);" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 30px rgba(37, 211, 102, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 24px rgba(37, 211, 102, 0.4)';">
                        <i class="fab fa-whatsapp" style="font-size: 18px;"></i> Compartilhar
                    </button>
                </div>
        </div>
        <% } %>
        
        <div class="actions">
            <% if (formUrl) { %>
            <a href="<%= formUrl %>" class="btn btn-secondary">
                <i class="fas fa-redo"></i> Preencher Novamente
            </a>
            <% } %>
            
            <button onclick="window.close()" class="btn btn-secondary" style="display: none;">
                <i class="fas fa-times"></i> Fechar
            </button>
        </div>
    </div>
    
    <script>
        // Auto-redirect ap√≥s 10 segundos (opcional)
        <% if (autoRedirect && redirectUrl) { %>
        setTimeout(() => {
            window.location.href = '<%= redirectUrl %>';
        }, 10000);
        <% } %>
        
        // Registrar evento de visualiza√ß√£o da p√°gina de sucesso
        if (typeof gtag !== 'undefined') {
            gtag('event', 'form_submit_success', {
                'event_category': 'Form',
                'event_label': 'Success Page View'
            });
        }
        
        <% if (showGuestListInfo && typeof qrToken !== 'undefined' && qrToken) { %>
        // Gerar QR Code
        const qrToken = '<%- qrToken %>';
        const eventTitle = '<%- typeof eventTitle !== 'undefined' ? eventTitle : "Evento" %>';
        const eventDate = '<%- typeof eventDate !== 'undefined' && eventDate ? eventDate : "" %>';
        const eventAddress = '<%- typeof eventAddress !== 'undefined' ? eventAddress : "" %>';
        const primaryColor = '<%- typeof primaryColor !== 'undefined' ? primaryColor : "#4A90E2" %>';
        const secondaryColor = '<%- typeof secondaryColor !== 'undefined' ? secondaryColor : "#6BA3F0" %>';
        
        // Dados dispon√≠veis no cliente
        <% 
            let personNameValue = '';
            if (typeof responseData !== 'undefined' && responseData && responseData.responder_name) {
                personNameValue = responseData.responder_name;
            } else if (typeof submittedData !== 'undefined' && submittedData) {
                // Tentar encontrar o nome nos dados submetidos
                if (submittedData.name) personNameValue = submittedData.name;
                else if (submittedData.nome) personNameValue = submittedData.nome;
                else if (submittedData.data_name) personNameValue = submittedData.data_name;
                else if (submittedData.data_nome) personNameValue = submittedData.data_nome;
                // Procurar em todas as chaves
                if (!personNameValue) {
                    Object.keys(submittedData).forEach(key => {
                        const keyLower = key.toLowerCase();
                        if ((keyLower.includes('name') || keyLower.includes('nome')) && !personNameValue) {
                            const value = submittedData[key];
                            if (value && typeof value === 'string' && value.trim().length >= 2) {
                                personNameValue = value;
                            }
                        }
                    });
                }
            }
            if (!personNameValue && typeof responseData !== 'undefined' && responseData && responseData.response_data) {
                const responseDataObj = responseData.response_data;
                if (responseDataObj.name) personNameValue = responseDataObj.name;
                else if (responseDataObj.nome) personNameValue = responseDataObj.nome;
                else if (responseDataObj.data_name) personNameValue = responseDataObj.data_name;
                else if (responseDataObj.data_nome) personNameValue = responseDataObj.data_nome;
                // Procurar em todas as chaves
                if (!personNameValue && typeof responseDataObj === 'object') {
                    Object.keys(responseDataObj).forEach(key => {
                        const keyLower = key.toLowerCase();
                        if ((keyLower.includes('name') || keyLower.includes('nome')) && !personNameValue) {
                            const value = responseDataObj[key];
                            if (value && typeof value === 'string' && value.trim().length >= 2) {
                                personNameValue = value;
                            }
                        }
                    });
                }
            }
        %>
        const personName = '<%- personNameValue || "" %>';
        
        console.log('üîç Debug QR Code:', {
            showGuestListInfo: <%= showGuestListInfo %>,
            qrToken: qrToken ? qrToken.substring(0, 10) + '...' : 'null',
            qrTokenLength: qrToken ? qrToken.length : 0
        });
        
        // URL para confirma√ß√£o via QR Code
        // O QR Code cont√©m apenas o token, que ser√° lido pelo scanner
        const qrCodeData = qrToken;
        
        if (!qrCodeData || qrCodeData.trim() === '') {
            console.error('‚ùå QR Token est√° vazio!');
            const container = document.getElementById('qrcode-container');
            if (container) {
                container.innerHTML = '<p style="color: red; padding: 20px;">Erro: QR Token n√£o encontrado. Por favor, entre em contato com o suporte.</p>';
            }
        } else {
            // Fun√ß√£o para gerar QR Code (aguarda DOM e biblioteca estarem prontos)
            let qrCodeAttempts = 0;
            const maxQRCodeAttempts = 50; // 50 * 200ms = 10 segundos m√°ximo
            
            function generateQRCode() {
                qrCodeAttempts++;
                
                if (qrCodeAttempts > maxQRCodeAttempts) {
                    console.error('‚ùå Limite de tentativas excedido. Biblioteca QRCode n√£o carregou.');
                    const container = document.getElementById('qrcode-container');
                    if (container) {
                        container.innerHTML = '<p style="color: red; padding: 20px;">Erro: N√£o foi poss√≠vel carregar a biblioteca de QR Code. Por favor, recarregue a p√°gina.</p>';
                    }
                    return;
                }
                
                console.log('üîÑ Tentando gerar QR Code... (tentativa ' + qrCodeAttempts + '/' + maxQRCodeAttempts + ')');
                
                // Verificar se a biblioteca qrcodejs est√° dispon√≠vel
                // A biblioteca qrcodejs exp√µe QRCode como construtor global
                if (typeof QRCode === 'undefined') {
                    console.warn('‚ö†Ô∏è Biblioteca QRCode ainda n√£o carregou, aguardando...');
                    setTimeout(generateQRCode, 200);
                    return;
                }
                
                const container = document.getElementById('qrcode-container');
                if (!container) {
                    console.warn('‚ö†Ô∏è Container do QR Code n√£o encontrado, aguardando DOM...');
                    setTimeout(generateQRCode, 200);
                    return;
                }
                
                if (!qrCodeData || qrCodeData.trim() === '') {
                    console.error('‚ùå qrCodeData est√° vazio!');
                    container.innerHTML = '<p style="color: red; padding: 20px;">Erro: Dados do QR Code n√£o encontrados.</p>';
                    return;
                }
                
                console.log('‚úÖ Gerando QR Code com token:', qrCodeData.substring(0, 20) + '...');
                
                try {
                    // Limpar container anterior se houver
                    container.innerHTML = '';
                    
                    // Usar qrcodejs que usa new QRCode() para criar o QR code
                    // Esta biblioteca cria o QR code diretamente no container
                    new QRCode(container, {
                        text: qrCodeData,
                        width: 300,
                        height: 300,
                        colorDark: '#000000',
                        colorLight: '#FFFFFF',
                        correctLevel: QRCode.CorrectLevel.M
                    });
                    
                    console.log('‚úÖ QR Code gerado com sucesso!');
                } catch (err) {
                    console.error('‚ùå Erro ao gerar QR Code:', err);
                    container.innerHTML = '<p style="color: red; padding: 20px;">Erro ao gerar QR Code: ' + (err.message || err.toString()) + '. Tente recarregar a p√°gina.</p>';
                }
            }
            
            // Aguardar DOM e biblioteca estarem prontos
            // Usar window.onload para garantir que todos os scripts foram carregados
            if (document.readyState === 'loading') {
                window.addEventListener('load', function() {
                    console.log('üìÑ P√°gina totalmente carregada, iniciando gera√ß√£o de QR Code...');
                    setTimeout(generateQRCode, 100);
                });
            } else {
                // Se a p√°gina j√° carregou, aguardar um pouco e tentar
                console.log('üìÑ DOM j√° est√° pronto, aguardando biblioteca...');
                setTimeout(generateQRCode, 100);
            }
        }
        
        // Fun√ß√£o auxiliar para obter o canvas do QR Code
        function getQRCodeCanvas() {
            const container = document.getElementById('qrcode-container');
            if (!container) return null;
            // A biblioteca qrcodejs cria um canvas dentro do container
            return container.querySelector('canvas') || container.querySelector('img');
        }
        
        // Fun√ß√£o para mostrar preview do QR Code (Melhoria 5)
        function showQRCodePreview() {
            const container = document.getElementById('qrcode-container');
            if (!container) return;
            
            const modal = document.createElement('div');
            modal.style.cssText = 'position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; align-items: center; justify-content: center; padding: 20px;';
            modal.onclick = function(e) { if (e.target === modal) modal.remove(); };
            
            // Pegar o canvas ou img do container
            const canvas = container.querySelector('canvas');
            const img = container.querySelector('img');
            const qrCodeDataUrl = canvas ? canvas.toDataURL('image/png') : (img ? img.src : '');
            if (!qrCodeDataUrl) return;
            modal.innerHTML = `
                <div style="background: white; border-radius: 24px; padding: 40px; max-width: 700px; width: 100%; text-align: center; position: relative; box-shadow: 0 20px 60px rgba(0,0,0,0.3);">
                    <button onclick="this.closest('div[style*=\\'position: fixed\\']').remove()" style="position: absolute; top: 20px; right: 20px; background: rgba(0,0,0,0.1); border: none; width: 44px; height: 44px; border-radius: 50%; cursor: pointer; font-size: 22px; color: #333; transition: all 0.3s;" onmouseover="this.style.background='rgba(0,0,0,0.2)'; this.style.transform='rotate(90deg)';" onmouseout="this.style.background='rgba(0,0,0,0.1)'; this.style.transform='rotate(0deg)';">√ó</button>
                    <div style="display: flex; align-items: center; justify-content: center; gap: 12px; margin-bottom: 28px;">
                        <div style="width: 48px; height: 48px; background: linear-gradient(135deg, ${primaryColor || '#4A90E2'}, ${secondaryColor || '#6BA3F0'}); border-radius: 12px; display: flex; align-items: center; justify-content: center;">
                            <i class="fas fa-qrcode" style="font-size: 24px; color: white;"></i>
                        </div>
                        <h2 style="margin: 0; color: #202124; font-size: 28px; font-weight: 800;">Preview do QR Code</h2>
                    </div>
                    <div style="background: linear-gradient(135deg, rgba(255,255,255,0.95), rgba(248,249,250,0.98)); border-radius: 20px; padding: 32px; margin-bottom: 28px; display: inline-block; box-shadow: 0 8px 32px rgba(0,0,0,0.12); border: 3px solid ${primaryColor || '#4A90E2'}40;">
                        <img src="${qrCodeDataUrl}" style="max-width: 450px; width: 100%; height: auto; border-radius: 12px;" alt="QR Code Preview">
                    </div>
                    <div style="display: flex; gap: 14px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="downloadQRCode(); this.closest('div[style*=\\'position: fixed\\']').remove();" style="padding: 14px 28px; background: linear-gradient(135deg, ${primaryColor || '#4A90E2'} 0%, ${secondaryColor || '#6BA3F0'} 100%); color: white; border: none; border-radius: 14px; font-weight: 700; font-size: 16px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 6px 24px rgba(74, 144, 226, 0.4); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 30px rgba(74, 144, 226, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 24px rgba(74, 144, 226, 0.4)';">
                            <i class="fas fa-download"></i> Baixar PNG
                        </button>
                        <button onclick="downloadQRCodePDF(); this.closest('div[style*=\\'position: fixed\\']').remove();" style="padding: 14px 28px; background: linear-gradient(135deg, #DC143C, #FF6347); color: white; border: none; border-radius: 14px; font-weight: 700; font-size: 16px; cursor: pointer; display: inline-flex; align-items: center; gap: 10px; box-shadow: 0 6px 24px rgba(220, 20, 60, 0.4); transition: all 0.3s;" onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 8px 30px rgba(220, 20, 60, 0.5)';" onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 6px 24px rgba(220, 20, 60, 0.4)';">
                            <i class="fas fa-file-pdf"></i> Baixar PDF
                        </button>
                    </div>
                </div>
            `;
            document.body.appendChild(modal);
        }
        
        // Fun√ß√£o auxiliar para quebrar texto em m√∫ltiplas linhas
        function wrapText(context, text, maxWidth, fontSize) {
            const words = text.split(' ');
            const lines = [];
            let currentLine = words[0];
            
            for (let i = 1; i < words.length; i++) {
                const word = words[i];
                const width = context.measureText(currentLine + ' ' + word).width;
                if (width < maxWidth) {
                    currentLine += ' ' + word;
                } else {
                    lines.push(currentLine);
                    currentLine = word;
                }
            }
            lines.push(currentLine);
            return lines;
        }
        
        // Fun√ß√£o para baixar QR Code como PNG personalizado (estilo Simpla melhorado)
        function downloadQRCode() {
            const container = document.getElementById('qrcode-container');
            if (!container) return;
            
            const canvas = container.querySelector('canvas');
            const img = container.querySelector('img');
            if (!canvas && !img) return;
            
            // Criar canvas personalizado com design estilo Simpla
            const finalCanvas = document.createElement('canvas');
            finalCanvas.width = 800;
            finalCanvas.height = 1100; // Aumentado para acomodar mais conte√∫do
            const ctx = finalCanvas.getContext('2d');
            
            // Cor de fundo branco
            ctx.fillStyle = '#FFFFFF';
            ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
            
            // Converter cores hex para RGB
            const primaryRgb = hexToRgb(primaryColor);
            const secondaryRgb = hexToRgb(secondaryColor);
            
            // Header com gradiente (estilo Simpla)
            const gradient = ctx.createLinearGradient(0, 0, finalCanvas.width, 0);
            gradient.addColorStop(0, `rgb(${primaryRgb.r}, ${primaryRgb.g}, ${primaryRgb.b})`);
            gradient.addColorStop(1, `rgb(${secondaryRgb.r}, ${secondaryRgb.g}, ${secondaryRgb.b})`);
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, finalCanvas.width, 130);
            
            // T√≠tulo no header
            ctx.fillStyle = '#FFFFFF';
            ctx.font = 'bold 36px Inter, sans-serif';
            ctx.textAlign = 'center';
            ctx.textBaseline = 'middle';
            ctx.fillText('Confirma√ß√£o de Presen√ßa', finalCanvas.width / 2, 45);
            
            // Subt√≠tulo
            ctx.font = '20px Inter, sans-serif';
            ctx.fillText('Apresente este QR Code na portaria', finalCanvas.width / 2, 80);
            
            // Nome da pessoa (se dispon√≠vel) - estilo Simpla
            let yPos = 200;
            if (personName && personName.trim() !== '') {
                ctx.fillStyle = '#202124';
                ctx.font = 'bold 40px Inter, sans-serif';
                ctx.textAlign = 'center';
                const nameLines = wrapText(ctx, personName, finalCanvas.width - 100, 40);
                nameLines.forEach((line, index) => {
                    ctx.fillText(line, finalCanvas.width / 2, yPos + (index * 45));
                });
                yPos += nameLines.length * 45 + 20;
            }
            
            // Fun√ß√£o para desenhar o resto do conte√∫do e fazer download
            function drawRemainingContentAndDownload(qrImageElement) {
                // QR Code centralizado com borda decorativa
                const qrSize = 380;
                const qrX = (finalCanvas.width - qrSize) / 2;
                const qrY = yPos;
                
                // Borda decorativa ao redor do QR Code
                ctx.strokeStyle = `rgb(${primaryRgb.r}, ${primaryRgb.g}, ${primaryRgb.b})`;
                ctx.lineWidth = 8;
                ctx.strokeRect(qrX - 20, qrY - 20, qrSize + 40, qrSize + 40);
                
                // Desenhar QR Code
                ctx.drawImage(qrImageElement, qrX, qrY, qrSize, qrSize);
                
                yPos += qrSize + 60;
                
                // Card de informa√ß√µes do evento com fundo destacado
                const cardY = yPos;
                const cardHeight = 200;
                
                // Fundo do card com gradiente sutil
                const cardGradient = ctx.createLinearGradient(0, cardY, 0, cardY + cardHeight);
                cardGradient.addColorStop(0, `rgba(${primaryRgb.r}, ${primaryRgb.g}, ${primaryRgb.b}, 0.08)`);
                cardGradient.addColorStop(1, `rgba(${secondaryRgb.r}, ${secondaryRgb.g}, ${secondaryRgb.b}, 0.05)`);
                ctx.fillStyle = cardGradient;
                ctx.fillRect(40, cardY, finalCanvas.width - 80, cardHeight);
                
                // Borda do card
                ctx.strokeStyle = `rgba(${primaryRgb.r}, ${primaryRgb.g}, ${primaryRgb.b}, 0.3)`;
                ctx.lineWidth = 2;
                ctx.strokeRect(40, cardY, finalCanvas.width - 80, cardHeight);
                
                let infoY = cardY + 30;
                
                // Nome do Evento - DESTACADO
                if (eventTitle) {
                    ctx.fillStyle = '#202124';
                    ctx.font = 'bold 32px Inter, sans-serif';
                    ctx.textAlign = 'center';
                    const titleLines = wrapText(ctx, eventTitle, finalCanvas.width - 120, 32);
                    titleLines.forEach((line, index) => {
                        ctx.fillText(line, finalCanvas.width / 2, infoY + (index * 38));
                    });
                    infoY += titleLines.length * 38 + 20;
                }
                
                // Data do Evento
                if (eventDate) {
                    ctx.fillStyle = '#5f6368';
                    ctx.font = 'bold 22px Inter, sans-serif';
                    ctx.textAlign = 'center';
                    ctx.fillText('üìÖ ' + eventDate, finalCanvas.width / 2, infoY);
                    infoY += 35;
                }
                
                // Endere√ßo do Evento - DESTACADO
                if (eventAddress) {
                    ctx.fillStyle = '#202124';
                    ctx.font = 'bold 20px Inter, sans-serif';
                    ctx.textAlign = 'center';
                    const maxWidth = finalCanvas.width - 120;
                    const addressLines = wrapText(ctx, 'üìç ' + eventAddress, maxWidth, 20);
                    addressLines.forEach((line, index) => {
                        ctx.fillText(line, finalCanvas.width / 2, infoY + (index * 28));
                    });
                    infoY += addressLines.length * 28 + 15;
                }
                
                yPos = cardY + cardHeight + 30;
                
                // Instru√ß√µes finais
                ctx.fillStyle = '#9aa0a6';
                ctx.font = '16px Inter, sans-serif';
                ctx.fillText('Apresente este QR Code na portaria do evento', finalCanvas.width / 2, yPos);
                ctx.fillText('Token: ' + qrToken.substring(0, 16) + '...', finalCanvas.width / 2, yPos + 25);
                
                // Footer
                ctx.fillStyle = '#f8f9fa';
                ctx.fillRect(0, finalCanvas.height - 60, finalCanvas.width, 60);
                ctx.fillStyle = '#9aa0a6';
                ctx.font = '14px Inter, sans-serif';
                ctx.fillText('King Forms - Sistema de Confirma√ß√£o de Presen√ßa', finalCanvas.width / 2, finalCanvas.height - 35);
                ctx.fillText('¬© 2026 Conecta King. Todos os direitos reservados.', finalCanvas.width / 2, finalCanvas.height - 15);
                
                // Fazer download
                const link = document.createElement('a');
                const fileName = personName && personName.trim() !== '' 
                    ? `QR-Code-${personName.replace(/[^a-z0-9]/gi, '-')}-${Date.now()}.png`
                    : `QR-Code-${eventTitle.replace(/[^a-z0-9]/gi, '-')}-${Date.now()}.png`;
                link.download = fileName;
                link.href = finalCanvas.toDataURL('image/png', 0.95);
                link.click();
            }
            
            // Fun√ß√£o auxiliar para quebrar texto em m√∫ltiplas linhas
            function wrapText(context, text, maxWidth, fontSize) {
                const words = text.split(' ');
                const lines = [];
                let currentLine = words[0];
                
                for (let i = 1; i < words.length; i++) {
                    const word = words[i];
                    const width = context.measureText(currentLine + ' ' + word).width;
                    if (width < maxWidth) {
                        currentLine += ' ' + word;
                    } else {
                        lines.push(currentLine);
                        currentLine = word;
                    }
                }
                lines.push(currentLine);
                return lines;
            }
            
            // Desenhar QR Code e fazer download
            if (canvas) {
                drawRemainingContentAndDownload(canvas);
            } else if (img) {
                const imgElement = new Image();
                imgElement.crossOrigin = 'anonymous';
                imgElement.onload = function() {
                    drawRemainingContentAndDownload(imgElement);
                };
                imgElement.onerror = function() {
                    alert('Erro ao carregar imagem do QR Code. Por favor, tente novamente.');
                };
                imgElement.src = img.src;
            }
        }
        
        // Fun√ß√£o para compartilhar QR Code via WhatsApp
        function shareQRCode() {
            const container = document.getElementById('qrcode-container');
            if (!container) return;
            
            const canvas = container.querySelector('canvas');
            const img = container.querySelector('img');
            if (!canvas && !img) return;
            
            const qrCodeImage = canvas ? canvas.toDataURL('image/png') : img.src;
            const message = `Ol√°! Este √© meu QR Code de confirma√ß√£o de presen√ßa:\n\n*Evento:* ${eventTitle}${eventDate ? '\n*Data:* ' + eventDate : ''}${eventAddress ? '\n*Local:* ' + eventAddress : ''}\n\nApresente este QR Code na portaria.`;
            
            // Converter imagem para base64 e enviar via WhatsApp
            const whatsappUrl = `https://wa.me/?text=${encodeURIComponent(message)}`;
            window.open(whatsappUrl, '_blank');
        }
        
        // Fun√ß√£o para baixar QR Code como PDF (premium design melhorado)
        function downloadQRCodePDF() {
            const container = document.getElementById('qrcode-container');
            if (!container) {
                alert('QR Code n√£o encontrado. Por favor, aguarde o carregamento.');
                return;
            }
            
            const canvas = container.querySelector('canvas');
            const img = container.querySelector('img');
            if (!canvas && !img) {
                alert('QR Code n√£o encontrado. Por favor, aguarde o carregamento.');
                return;
            }
            
            // Fun√ß√£o para tentar fazer download do PDF
            function tryDownloadPDF(attempt = 0) {
                const maxAttempts = 25; // 5 segundos m√°ximo
                
                // Verificar m√∫ltiplas formas de acesso √† biblioteca jsPDF
                let jsPDFLib = null;
                if (typeof window.jspdf !== 'undefined') {
                    if (window.jspdf.jsPDF) {
                        jsPDFLib = window.jspdf.jsPDF;
                    } else if (window.jspdf.default) {
                        jsPDFLib = window.jspdf.default;
                    } else {
                        // Tentar usar diretamente
                        jsPDFLib = window.jspdf;
                    }
                } else if (typeof jsPDF !== 'undefined') {
                    jsPDFLib = jsPDF;
                } else if (typeof window.jsPDF !== 'undefined') {
                    jsPDFLib = window.jsPDF;
                }
                
                if (!jsPDFLib) {
                    if (attempt < maxAttempts) {
                        setTimeout(() => tryDownloadPDF(attempt + 1), 200);
                        return;
                    } else {
                        alert('Biblioteca PDF n√£o carregada. Por favor, recarregue a p√°gina e tente novamente.');
                        return;
                    }
                }
                
                try {
                    const qrCodeImage = canvas ? canvas.toDataURL('image/png') : img.src;
                    const doc = new jsPDFLib({
                        orientation: 'portrait',
                        unit: 'mm',
                        format: [210, 297] // A4
                    });
                    
                    // Cores
                    const primaryRgb = hexToRgb(primaryColor);
                    const secondaryRgb = hexToRgb(secondaryColor);
                    
                    // Header com gradiente (estilo Simpla melhorado)
                    doc.setFillColor(primaryRgb.r, primaryRgb.g, primaryRgb.b);
                    doc.rect(0, 0, 210, 55, 'F');
                    
                    // T√≠tulo no header
                    doc.setTextColor(255, 255, 255);
                    doc.setFontSize(28);
                    doc.setFont('helvetica', 'bold');
                    doc.text('Confirma√ß√£o de Presen√ßa', 105, 22, { align: 'center' });
                    
                    // Subt√≠tulo
                    doc.setFontSize(13);
                    doc.setTextColor(255, 255, 255);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Apresente este QR Code na portaria', 105, 32, { align: 'center' });
                    
                    // Nome da pessoa (se dispon√≠vel) - estilo Simpla
                    let yPos = 70;
                    if (personName && personName.trim() !== '') {
                        doc.setTextColor(0, 0, 0);
                        doc.setFontSize(24);
                        doc.setFont('helvetica', 'bold');
                        const nameLines = doc.splitTextToSize(personName, 190);
                        doc.text(nameLines, 105, yPos, { align: 'center' });
                        yPos += nameLines.length * 10 + 8;
                    }
                    
                    // QR Code centralizado com borda
                    const qrSize = 75; // mm
                    const qrX = (210 - qrSize) / 2;
                    
                    // Borda decorativa
                    doc.setDrawColor(primaryRgb.r, primaryRgb.g, primaryRgb.b);
                    doc.setLineWidth(1);
                    doc.rect(qrX - 5, yPos - 5, qrSize + 10, qrSize + 10);
                    
                    doc.addImage(qrCodeImage, 'PNG', qrX, yPos, qrSize, qrSize);
                    
                    yPos += qrSize + 25;
                    
                    // Card de informa√ß√µes do evento
                    const cardY = yPos;
                    const cardHeight = 60;
                    
                    // Fundo do card
                    doc.setFillColor(248, 249, 250);
                    doc.rect(15, cardY - 5, 180, cardHeight, 'F');
                    
                    // Borda do card
                    doc.setDrawColor(primaryRgb.r, primaryRgb.g, primaryRgb.b);
                    doc.setLineWidth(0.5);
                    doc.rect(15, cardY - 5, 180, cardHeight);
                    
                    let infoY = cardY + 8;
                    
                    // Nome do Evento - DESTACADO
                    if (eventTitle) {
                        doc.setTextColor(0, 0, 0);
                        doc.setFontSize(18);
                        doc.setFont('helvetica', 'bold');
                        const titleLines = doc.splitTextToSize(eventTitle, 180);
                        doc.text(titleLines, 105, infoY, { align: 'center' });
                        infoY += titleLines.length * 8 + 6;
                    }
                    
                    // Data do Evento
                    if (eventDate) {
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'normal');
                        doc.setTextColor(95, 99, 104);
                        doc.text('üìÖ ' + eventDate, 105, infoY, { align: 'center', maxWidth: 180 });
                        infoY += 8;
                    }
                    
                    // Endere√ßo do Evento - DESTACADO
                    if (eventAddress) {
                        doc.setFontSize(11);
                        doc.setFont('helvetica', 'bold');
                        doc.setTextColor(0, 0, 0);
                        const addressLines = doc.splitTextToSize('üìç ' + eventAddress, 180);
                        doc.text(addressLines, 105, infoY, { align: 'center' });
                        infoY += addressLines.length * 6;
                    }
                    
                    yPos = cardY + cardHeight + 15;
                    
                    // Instru√ß√µes
                    doc.setFontSize(10);
                    doc.setTextColor(100, 100, 100);
                    doc.setFont('helvetica', 'normal');
                    doc.text('Apresente este QR Code na portaria do evento', 105, yPos, { align: 'center' });
                    doc.text('Token: ' + qrToken.substring(0, 16) + '...', 105, yPos + 6, { align: 'center' });
                    
                    // Footer
                    doc.setFillColor(248, 249, 250);
                    doc.rect(0, 280, 210, 17, 'F');
                    doc.setFontSize(8);
                    doc.setTextColor(150, 150, 150);
                    doc.text('King Forms - Sistema de Confirma√ß√£o de Presen√ßa', 105, 287, { align: 'center' });
                    doc.text('¬© 2026 Conecta King. Todos os direitos reservados.', 105, 292, { align: 'center' });
                    
                    // Salvar
                    const fileName = personName && personName.trim() !== '' 
                        ? `QR-Code-${personName.replace(/[^a-z0-9]/gi, '-')}-${Date.now()}.pdf`
                        : `QR-Code-${eventTitle.replace(/[^a-z0-9]/gi, '-')}-${Date.now()}.pdf`;
                    doc.save(fileName);
                } catch (error) {
                    console.error('Erro ao gerar PDF:', error);
                    alert('Erro ao gerar PDF. Por favor, tente novamente ou recarregue a p√°gina.');
                }
            }
            
            // Iniciar tentativa de download
            tryDownloadPDF();
        }
        
        // Fun√ß√£o auxiliar para converter hex para RGB
        function hexToRgb(hex) {
            const result = /^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(hex);
            return result ? {
                r: parseInt(result[1], 16),
                g: parseInt(result[2], 16),
                b: parseInt(result[3], 16)
            } : { r: 74, g: 144, b: 226 };
        }
        
        // Aguardar carregamento da biblioteca PDF
        let pdfLibraryLoaded = false;
        function checkPDFLibrary() {
            if (typeof window.jspdf !== 'undefined' || typeof jsPDF !== 'undefined' || typeof window.jsPDF !== 'undefined') {
                pdfLibraryLoaded = true;
                return true;
            }
            return false;
        }
        
        // Verificar periodicamente se a biblioteca foi carregada
        let pdfCheckAttempts = 0;
        const maxPDFCheckAttempts = 50;
        function waitForPDFLibrary() {
            pdfCheckAttempts++;
            if (checkPDFLibrary() || pdfCheckAttempts >= maxPDFCheckAttempts) {
                pdfLibraryLoaded = true;
                return;
            }
            setTimeout(waitForPDFLibrary, 200);
        }
        
        // Iniciar verifica√ß√£o quando a p√°gina carregar
        if (document.readyState === 'loading') {
            window.addEventListener('load', waitForPDFLibrary);
        } else {
            waitForPDFLibrary();
        }
        <% } %>
    </script>
</body>
</html>
